Botia2.0 ‚Äì Discord Music & TTS Bot

Bot de Discord con funcionalidades de TTS, clima, y reproducci√≥n de m√∫sica desde YouTube y archivos MP3 subidos.

‚öôÔ∏è Instalaci√≥n

Clona este repositorio o descarga el c√≥digo.

Instala las dependencias:

pip install discord.py python-dotenv gTTS yt-dlp requests


Descarga FFmpeg
 y actualiza la ruta FFMPEG_PATH en main.py.

Crea un archivo .env con tu token de Discord:

DISCORD_TOKEN=TU_TOKEN_AQUI


Ejecuta el bot:

python main.py

üé∂ Comandos del Bot
Voz

!entrar ‚Üí El bot se une al canal de voz donde est√°s.

!salir ‚Üí El bot se desconecta del canal de voz.

Texto a Voz (TTS)

!say <mensaje> ‚Üí El bot repite tu mensaje en el canal de voz.

!weather <ciudad> ‚Üí El bot dice el clima de la ciudad indicada.

M√∫sica

!play <URL o b√∫squeda> ‚Üí Reproduce una canci√≥n de YouTube o agrega un archivo MP3 subido.

!cola ‚Üí Muestra la cola de canciones.

!pause ‚Üí Pausa la canci√≥n actual.

!resume ‚Üí Reanuda la canci√≥n pausada.

!skip ‚Üí Salta la canci√≥n actual y reproduce la siguiente en la cola.

!stop ‚Üí Detiene la m√∫sica, limpia la cola y desconecta el bot.

Archivos MP3

Sube un archivo .mp3 al canal y usa !play sin argumento.

Se agregar√° autom√°ticamente a la cola de reproducci√≥n.

üìå Notas

Aseg√∫rate de que FFmpeg est√© instalado y la ruta correcta configurada en main.py.

El bot reproduce canciones en orden de llegada (cola FIFO).

Puedes combinar YouTube y archivos locales en la misma cola.

# ARREGLO IMPORTANTE DEL BOT

El mensaje clave era este:

KeyError: 'url'


Eso significa que tu c√≥digo intentaba acceder a info['url'] dentro de la funci√≥n get_youtube_audio, pero esa clave no exist√≠a en el diccionario que devolv√≠a yt_dlp.

¬øPor qu√© ocurr√≠a?

Cuando usas 'default_search': 'ytsearch' en yt_dlp, si la b√∫squeda devuelve varios resultados, yt_dlp no devuelve directamente un diccionario con 'url'.

Devuelve un diccionario con una clave 'entries' que contiene la lista de resultados.

Cada resultado dentro de 'entries' s√≠ tiene la URL que necesitas ('url' o 'webpage_url').

En tu c√≥digo original hac√≠as:

info = ydl.extract_info(query, download=False)
return info['url']


Esto funciona si query es un enlace directo de YouTube.

Pero si query era un t√©rmino de b√∫squeda (por ejemplo: "Smack that"), info no ten√≠a 'url', sino 'entries', y por eso saltaba el KeyError.

C√≥mo lo arreglamos

En mi versi√≥n corregida, agregamos:

if 'entries' in info and len(info['entries']) > 0:
    info = info['entries'][0]
return info['url'] if 'url' in info else info['webpage_url']


Esto hace dos cosas:

Si info contiene 'entries' (una b√∫squeda), toma el primer resultado.

Si no existe 'url', usamos 'webpage_url', que siempre apunta al video.